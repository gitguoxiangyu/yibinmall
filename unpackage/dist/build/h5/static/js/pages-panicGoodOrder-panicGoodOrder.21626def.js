(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-panicGoodOrder-panicGoodOrder"],{"015a":function(e,t,a){"use strict";function i(e,t){var a={username:"admin",password:"admin123"};uni.request({url:"http://yibinmall.chenglee.top:81/prod-api/auth/get_token",method:"POST",data:a,dataType:"json",sslVerify:!1,success:e,fail:t})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i;t.default=n},"2bfd":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.baseURL=void 0;var i="http://yibinmall.chenglee.top:81/prod-api/mall";t.baseURL=i},"31c1":function(e,t,a){var i=a("d4e3");"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var n=a("4f06").default;n("0078b0f0",i,!0,{sourceMap:!1,shadowMode:!1})},"49d8":function(e,t,a){"use strict";a.r(t);var i=a("4dd0"),n=a("66cc");for(var o in n)"default"!==o&&function(e){a.d(t,e,(function(){return n[e]}))}(o);a("bc42");var s,d=a("f0c5"),r=Object(d["a"])(n["default"],i["b"],i["c"],!1,null,"add54daa",null,!1,i["a"],s);t["default"]=r.exports},"4dd0":function(e,t,a){"use strict";var i;a.d(t,"b",(function(){return n})),a.d(t,"c",(function(){return o})),a.d(t,"a",(function(){return i}));var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-uni-view",{staticClass:"main"},[a("v-uni-view",{staticClass:"item"},[a("v-uni-view",{staticClass:"head"},[a("v-uni-view",{staticClass:"container"},[a("img",{staticClass:"goodImg",attrs:{src:e.details.goods.goods_main_picture,alt:"商品图片"}}),a("v-uni-view",{staticClass:"goodText"},[a("v-uni-view",{staticClass:"goodDetail"},[e._v(e._s(e.details.goods.goods_name))]),a("v-uni-view",{staticClass:"goodPrice"},[e._v("共青价："),a("span",{staticStyle:{color:"red","font-weight":"bold"}},[e._v("鲜豆"+e._s(e.details.panicBuyingGoods.panic_buying_price))])])],1)],1),a("v-uni-view",{staticClass:"deliveryWay"},[a("v-uni-view",{staticClass:"way"},[e._v("配送方式：")]),a("v-uni-view",{staticClass:"deliver"},[e._v("线下商家配送（ 送货上门 ）")])],1)],1),a("v-uni-view",{staticClass:"body",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.change.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"option"},[a("v-uni-view",[e._v("收货人")]),a("v-uni-view",[e._v(e._s(e.person.real_name))])],1),a("v-uni-view",{staticClass:"option"},[a("v-uni-view",[e._v("收货电话")]),a("v-uni-view",[e._v(e._s(e.person.tel))])],1),a("v-uni-view",{staticClass:"option"},[a("v-uni-view",[e._v("收货地址")]),a("v-uni-view",[e._v(e._s(e.person.address))])],1),a("v-uni-view",{staticClass:"option"},[a("v-uni-view",[e._v("货物数量")]),a("v-uni-view",[e._v(e._s(e.person.number))])],1)],1),a("v-uni-view",{staticClass:"foot"},[a("v-uni-view",{staticClass:"bean"},[a("v-uni-view",[e._v("商品鲜豆")]),a("v-uni-view",[e._v(e._s(e.details.panicBuyingGoods.panic_buying_price))])],1),a("v-uni-view",{staticClass:"star"},[a("v-uni-view",[e._v("会员星级")]),a("v-uni-view",[e._v(e._s(e.details.goods.star)+"星")])],1),a("v-uni-view",{staticClass:"flashTime"},[a("v-uni-view",[e._v("市场价")]),a("v-uni-view",[e._v(e._s(e.details.goods.market_price)+"元")])],1),a("v-uni-view",{staticClass:"sum"},[a("span",{staticStyle:{color:"red","font-weight":"bold"}},[e._v("鲜豆"+e._s(e.person.number*e.details.panicBuyingGoods.panic_buying_price))]),e._v("合计：")])],1)],1),a("v-uni-view",{staticClass:"pay"},[a("v-uni-view",{staticStyle:{color:"red","font-weight":"bold"}},[e._v("鲜豆"+e._s(e.person.number*e.details.panicBuyingGoods.panic_buying_price))]),a("v-uni-view",{staticClass:"btn"},[a("v-uni-button",{staticClass:"btn",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.buy.apply(void 0,arguments)}}},[e._v("立即支付")])],1)],1),e.showPop?a("v-uni-view",{staticClass:"modal"},[a("v-uni-view",{staticClass:"inputItem"},[e._v("收货人"),a("v-uni-input",{staticClass:"input",attrs:{type:"text",name:"name",placeholder:"请输入收货人姓名","placeholder-style":"font-size:26rpx;color:grey;"},model:{value:e.person.real_name,callback:function(t){e.$set(e.person,"real_name",t)},expression:"person.real_name"}})],1),a("v-uni-view",{staticClass:"inputItem"},[e._v("收货电话"),a("v-uni-input",{staticClass:"input",attrs:{type:"text",name:"phone",placeholder:"请输入收货电话","placeholder-style":"font-size:26rpx;color:grey;"},model:{value:e.person.tel,callback:function(t){e.$set(e.person,"tel",t)},expression:"person.tel"}})],1),a("v-uni-view",{staticClass:"inputItem"},[e._v("收货地址"),a("v-uni-input",{staticClass:"input",attrs:{type:"text",name:"address",placeholder:"请输入收货地址","placeholder-style":"font-size:26rpx;color:grey;"},model:{value:e.person.address,callback:function(t){e.$set(e.person,"address",t)},expression:"person.address"}})],1),a("v-uni-view",{staticClass:"inputItem"},[e._v("货物数量"),a("v-uni-input",{staticClass:"input",attrs:{type:"text",name:"phone",placeholder:"请输入货物数量","placeholder-style":"font-size:26rpx;color:grey;"},model:{value:e.person.number,callback:function(t){e.$set(e.person,"number",t)},expression:"person.number"}})],1),a("v-uni-button",{staticClass:"login",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.closeModal()}}},[e._v("确定")])],1):e._e()],1)},o=[]},"567c":function(e,t,a){"use strict";(function(e){function a(){getApp();var t={username:"admin",password:"admin123"},a={appId:"ZYSC_YB",secert:"123456"};uni.request({url:"http://yibinmall.chenglee.top:8080/get_token",method:"POST",data:t,dataType:"json",sslVerify:!1,success:function(t){var i=getApp();i.globalData.Authorization=t.data;var n={idCard:i.globalData.idCard,token:i.globalData.token};uni.request({url:"http://yibinmall.chenglee.top/province/data/getToken",method:"POST",data:a,header:{Authorization:"Bearer "+i.globalData.Authorization},dataType:"json",sslVerify:!1,success:function(t){i.globalData.token=t.data.data,uni.request({url:"http://yibinmall.chenglee.top/province/user/info",method:"POST",data:n,dataType:"json",sslVerify:!1,success:function(t){e("log",t," at publicAPI/updataPersonMsg.js:45"),i.globalData.UserInfo={id:t.data.data.id,real_name:t.data.data.realname,card_num:t.data.data.cardNum,card_type:t.data.data.cardType,ICBC_card_num:i.globalData.UserInfo.ICBC_card_num,avatar:t.data.data.avatar,mobile:t.data.data.mobile,beans:t.data.data.score,star:t.data.data.certificate}},fail:function(e){uni.hideLoading(),uni.showToast({icon:"none",title:"鲜豆更新错误"})}})},fail:function(e){uni.showToast({icon:"none",title:"获取token失败，请重试！"})}})},fail:function(e){uni.showToast({icon:"none",title:"获取token失败，请重试！"})}})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a;t.default=i}).call(this,a("0de9")["log"])},"66cc":function(e,t,a){"use strict";a.r(t);var i=a("decc"),n=a.n(i);for(var o in i)"default"!==o&&function(e){a.d(t,e,(function(){return i[e]}))}(o);t["default"]=n.a},bc42:function(e,t,a){"use strict";var i=a("31c1"),n=a.n(i);n.a},d4e3:function(e,t,a){var i=a("24fb");t=i(!1),t.push([e.i,".main[data-v-add54daa]{height:100vh;background-color:#f5f5f5}.item[data-v-add54daa]{height:70vh;display:flex;flex-direction:column;justify-content:space-between}.head[data-v-add54daa]{height:18vh;padding:5vw;background-color:#fff}.container[data-v-add54daa]{display:flex;flex-wrap:wrap;flex-direction:row;justify-content:space-between;height:30vw}.goodImg[data-v-add54daa]{height:20vw;width:20vw;display:inline;border-radius:5%}.goodText[data-v-add54daa]{width:60vw;display:flex;flex-direction:column;justify-content:space-between}.goodDetail[data-v-add54daa]{width:60vw;height:13vw;overflow:hidden;font-weight:700;font-size:10px}.goodPrice[data-v-add54daa]{width:60vw;height:12vw;font-size:10px}.deliveryWay[data-v-add54daa]{font-size:10px;display:flex;flex-direction:row;justify-content:space-between}.body[data-v-add54daa]{font-size:10px;padding:5vw;background-color:#fff}.option[data-v-add54daa]{margin:1vh 0;display:flex;flex-direction:row;justify-content:space-between}.foot[data-v-add54daa]{font-size:10px;padding:5vw;background-color:#fff}.bean[data-v-add54daa]{display:flex;flex-direction:row;justify-content:space-between}.star[data-v-add54daa]{margin:1vh 0;display:flex;flex-direction:row;justify-content:space-between}.flashTime[data-v-add54daa]{margin:1vh 0;display:flex;flex-direction:row;justify-content:space-between}.sum[data-v-add54daa]{margin:1vh 0;display:flex;flex-direction:row-reverse}.pay[data-v-add54daa]{width:100vw;height:4vh;padding:5vw;position:fixed;bottom:0;background-color:#fff;display:flex;flex-direction:row;justify-content:space-between}.btn[data-v-add54daa]{width:28vw;height:3vh;margin-right:10vw;background-color:red;color:#fff;line-height:3vh;text-align:center;border-radius:12px}\n\n/* 弹窗 */.modal[data-v-add54daa]{position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);background-color:#fff;width:70vw;border:1px #c3c3c3 solid;padding:1vh 3vw}.inputItem[data-v-add54daa]{display:flex;flex-direction:row;font-size:12px;margin:2vh 0;vertical-align:sub}.input[data-v-add54daa]{margin-left:3vw;border-bottom:1px #c3c3c3 solid}",""]),e.exports=t},decc:function(e,t,a){"use strict";(function(e){var i=a("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;i(a("015a")),i(a("567c"));var n=a("2bfd"),o={data:function(){return{showPop:!1,details:{},person:getApp().globalData.UserInfo,post:{order_user_id:void 0,store_id:void 0,goods_id:void 0,coupons_id:void 0,number:void 0,order_status:void 0,consignee_name:void 0,consignee_phone:void 0,consignee_address:void 0,deliver_type:void 0,order_time:void 0,deliver_time:void 0}}},onLoad:function(t){t.details&&(this.details=JSON.parse(decodeURIComponent(t.details)),e("log",this.details," at pages/panicGoodOrder/panicGoodOrder.vue:110")),this.person.number=1,e("log",getApp().globalData.UserInfo," at pages/panicGoodOrder/panicGoodOrder.vue:113")},methods:{buy:function(){if(this.person.address&&this.person.tel&&this.person.real_name&&this.person.star>=this.details.goods.star&&this.person.beans>=this.person.number*this.details.panicBuyingGoods.panic_buying_price){this.post.order_user_id=this.person.id,this.post.store_id=this.details.goods.store_id,this.post.goods_id=this.details.goods.goods_id,this.post.coupons_id=this.details.goods.coupons_id,this.post.number=this.person.number,this.post.order_status="已支付",this.post.consignee_name=this.person.real_name,this.post.consignee_phone=this.person.tel,this.post.consignee_address=this.person.address,this.post.deliver_type="线下厂商配送",this.post.order_time=(new Date).getTime(),this.post.deliver_time=void 0,e("log",this.post," at pages/panicGoodOrder/panicGoodOrder.vue:132");var t=getApp(),a={user_id:this.person.id,type:1,thingsId:this.details.goods.goods_id};uni.request({url:n.baseURL+"/pb_orders",method:"POST",data:this.post,header:{Authorization:"Bearer "+t.globalData.Authorization},dataType:"json",sslVerify:!1,success:function(i){if(e("log",i," at pages/panicGoodOrder/panicGoodOrder.vue:166"),200==i.data.code){uni.showLoading({title:i.data.message});var o=setInterval((function(){uni.request({url:n.baseURL+"/pb_orders/result/"+a.user_id+"/"+a.type+"/"+a.thingsId,method:"GET",header:{Authorization:"Bearer "+t.globalData.Authorization},dataType:"json",sslVerify:!1,success:function(t){e("log",t," at pages/panicGoodOrder/panicGoodOrder.vue:183"),uni.hideLoading(),200==t.data.code?(uni.showModal({title:"抢购成功",success:function(e){(e.confirm||e.cancel)&&setTimeout((function(){uni.navigateTo({url:"../mall/mall"})}),500)}}),clearInterval(o)):500==t.data.code&&(uni.hideLoading(),uni.showToast({icon:"none",title:t.data.message}),clearInterval(o))},fail:function(e){uni.hideLoading(),uni.showToast({icon:"none",title:"订单信息获取失败，请重试！"}),uni.hideLoading()}})}),1e3)}else uni.showToast({icon:"none",title:i.data.message})},fail:function(e){uni.showToast({icon:"none",title:"订单信息发送失败，请重试！"})}})}else this.person.star<this.details.star?uni.showToast({icon:"none",title:"用户星级不足"}):this.person.beans<this.person.number*this.details.panicBuyingGoods.panic_buying_price?uni.showToast({icon:"none",title:"用户鲜豆不足"}):(e("log",this.person," at pages/panicGoodOrder/panicGoodOrder.vue:254"),uni.showToast({icon:"none",title:"请检查收货信息是否正确"}))},change:function(){this.showPop=!0},closeModal:function(){this.showPop=!1}}};t.default=o}).call(this,a("0de9")["log"])}}]);