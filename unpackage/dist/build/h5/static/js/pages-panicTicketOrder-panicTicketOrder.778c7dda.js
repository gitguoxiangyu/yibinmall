(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-panicTicketOrder-panicTicketOrder"],{"015a":function(e,t,i){"use strict";function a(e,t){var i={username:"admin",password:"admin123"};uni.request({url:"http://yibinmall.chenglee.top:81/prod-api/auth/get_token",method:"POST",data:i,dataType:"json",sslVerify:!1,success:e,fail:t})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a;t.default=n},1502:function(e,t,i){"use strict";i.r(t);var a=i("e0df"),n=i.n(a);for(var o in a)"default"!==o&&function(e){i.d(t,e,(function(){return a[e]}))}(o);t["default"]=n.a},"2bfd":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.baseURL=void 0;var a="http://yibinmall.chenglee.top:81/prod-api/mall";t.baseURL=a},"567c":function(e,t,i){"use strict";(function(e){function i(){getApp();var t={username:"admin",password:"admin123"},i={appId:"ZYSC_YB",secert:"123456"};uni.request({url:"http://yibinmall.chenglee.top:8080/get_token",method:"POST",data:t,dataType:"json",sslVerify:!1,success:function(t){var a=getApp();a.globalData.Authorization=t.data;var n={idCard:a.globalData.idCard,token:a.globalData.token};uni.request({url:"http://yibinmall.chenglee.top/province/data/getToken",method:"POST",data:i,header:{Authorization:"Bearer "+a.globalData.Authorization},dataType:"json",sslVerify:!1,success:function(t){a.globalData.token=t.data.data,uni.request({url:"http://yibinmall.chenglee.top/province/user/info",method:"POST",data:n,dataType:"json",sslVerify:!1,success:function(t){e("log",t," at publicAPI/updataPersonMsg.js:45"),a.globalData.UserInfo={id:t.data.data.id,real_name:t.data.data.realname,card_num:t.data.data.cardNum,card_type:t.data.data.cardType,ICBC_card_num:a.globalData.UserInfo.ICBC_card_num,avatar:t.data.data.avatar,mobile:t.data.data.mobile,beans:t.data.data.score,star:t.data.data.certificate}},fail:function(e){uni.hideLoading(),uni.showToast({icon:"none",title:"鲜豆更新错误"})}})},fail:function(e){uni.showToast({icon:"none",title:"获取token失败，请重试！"})}})},fail:function(e){uni.showToast({icon:"none",title:"获取token失败，请重试！"})}})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i;t.default=a}).call(this,i("0de9")["log"])},"5d8e":function(e,t,i){"use strict";i.r(t);var a=i("795d"),n=i("1502");for(var o in n)"default"!==o&&function(e){i.d(t,e,(function(){return n[e]}))}(o);i("63c0");var s,r=i("f0c5"),d=Object(r["a"])(n["default"],a["b"],a["c"],!1,null,"6e38691a",null,!1,a["a"],s);t["default"]=d.exports},"63c0":function(e,t,i){"use strict";var a=i("b9a2"),n=i.n(a);n.a},"795d":function(e,t,i){"use strict";var a;i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return o})),i.d(t,"a",(function(){return a}));var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-uni-view",{staticClass:"main"},[i("v-uni-view",{staticClass:"item"},[i("v-uni-view",{staticClass:"head"},[i("v-uni-view",{staticClass:"container"},[i("img",{staticClass:"goodImg",attrs:{src:e.details.coupons.main_picture,alt:"商品图片"}}),i("v-uni-view",{staticClass:"goodText"},[i("v-uni-view",{staticClass:"goodDetail"},[e._v(e._s(e.details.coupons.coupon_name))]),i("v-uni-view",{staticClass:"goodPrice"},[e._v("共青价："),i("span",{staticStyle:{color:"red","font-weight":"bold"}},[e._v("鲜豆"+e._s(e.details.panicBuyingCoupons.panic_buying_price))])])],1)],1)],1),i("v-uni-view",{staticClass:"body",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.change.apply(void 0,arguments)}}},[i("v-uni-view",{staticClass:"option"},[i("v-uni-view",[e._v("收货人")]),i("v-uni-view",[e._v(e._s(e.person.real_name))])],1),i("v-uni-view",{staticClass:"option"},[i("v-uni-view",[e._v("收货电话")]),i("v-uni-view",[e._v(e._s(e.person.tel))])],1),i("v-uni-view",{staticClass:"option"},[i("v-uni-view",[e._v("货物数量")]),i("v-uni-view",[e._v(e._s(e.person.number))])],1)],1),i("v-uni-view",{staticClass:"foot"},[i("v-uni-view",{staticClass:"bean"},[i("v-uni-view",[e._v("商品鲜豆")]),i("v-uni-view",[e._v(e._s(e.details.panicBuyingCoupons.panic_buying_price))])],1),i("v-uni-view",{staticClass:"star"},[i("v-uni-view",[e._v("会员星级")]),i("v-uni-view",[e._v(e._s(e.details.coupons.star)+"星")])],1),i("v-uni-view",{staticClass:"flashTime"},[i("v-uni-view",[e._v("市场价")]),i("v-uni-view",[e._v(e._s(e.details.coupons.market_price)+"元")])],1),i("v-uni-view",{staticClass:"sum"},[i("span",{staticStyle:{color:"red","font-weight":"bold"}},[e._v("鲜豆"+e._s(e.person.number*e.details.panicBuyingCoupons.panic_buying_price))]),e._v("合计：")])],1)],1),i("v-uni-view",{staticClass:"pay"},[i("v-uni-view",{staticStyle:{color:"red","font-weight":"bold"}},[e._v("鲜豆"+e._s(e.person.number*e.details.panicBuyingCoupons.panic_buying_price))]),i("v-uni-view",{staticClass:"btn"},[i("v-uni-button",{staticClass:"btn",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.buy.apply(void 0,arguments)}}},[e._v("立即支付")])],1)],1),e.showPop?i("v-uni-view",{staticClass:"modal"},[i("v-uni-view",{staticClass:"inputItem"},[e._v("收货人"),i("v-uni-input",{staticClass:"input",attrs:{type:"text",name:"name",placeholder:"请输入收货人姓名","placeholder-style":"font-size:26rpx;color:grey;"},model:{value:e.person.real_name,callback:function(t){e.$set(e.person,"real_name",t)},expression:"person.real_name"}})],1),i("v-uni-view",{staticClass:"inputItem"},[e._v("收货电话"),i("v-uni-input",{staticClass:"input",attrs:{type:"text",name:"phone",placeholder:"请输入收货电话","placeholder-style":"font-size:26rpx;color:grey;"},model:{value:e.person.tel,callback:function(t){e.$set(e.person,"tel",t)},expression:"person.tel"}})],1),i("v-uni-view",{staticClass:"inputItem"},[e._v("货物数量"),i("v-uni-input",{staticClass:"input",attrs:{type:"text",name:"phone",placeholder:"请输入货物数量","placeholder-style":"font-size:26rpx;color:grey;"},model:{value:e.person.number,callback:function(t){e.$set(e.person,"number",t)},expression:"person.number"}})],1),i("v-uni-button",{staticClass:"login",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.closeModal()}}},[e._v("确定")])],1):e._e()],1)},o=[]},"7bb4":function(e,t,i){var a=i("24fb");t=a(!1),t.push([e.i,".main[data-v-6e38691a]{height:100vh;background-color:#f5f5f5}.item[data-v-6e38691a]{height:70vh;display:flex;flex-direction:column;justify-content:space-between}.head[data-v-6e38691a]{height:18vh;padding:5vw;background-color:#fff}.container[data-v-6e38691a]{display:flex;flex-wrap:wrap;flex-direction:row;justify-content:space-between;height:30vw}.goodImg[data-v-6e38691a]{height:20vw;width:20vw;display:inline;border-radius:5%}.goodText[data-v-6e38691a]{width:60vw;display:flex;flex-direction:column;justify-content:space-between}.goodDetail[data-v-6e38691a]{width:60vw;height:13vw;overflow:hidden;font-weight:700;font-size:10px}.goodPrice[data-v-6e38691a]{width:60vw;height:12vw;font-size:10px}.deliveryWay[data-v-6e38691a]{font-size:10px;display:flex;flex-direction:row;justify-content:space-between}.body[data-v-6e38691a]{font-size:10px;padding:5vw;background-color:#fff}.option[data-v-6e38691a]{margin:1vh 0;display:flex;flex-direction:row;justify-content:space-between}\n\n/* .tel{\n\tmargin: 1vh 0;\n\tdisplay: flex;\n\tflex-direction: row;\n\tjustify-content: space-between;\n}\n.address{\n\tmargin: 1vh 0;\n\tdisplay: flex;\n\tflex-direction: row;\n\tjustify-content: space-between;\n} */.foot[data-v-6e38691a]{font-size:10px;padding:5vw;background-color:#fff}.bean[data-v-6e38691a]{display:flex;flex-direction:row;justify-content:space-between}.star[data-v-6e38691a]{margin:1vh 0;display:flex;flex-direction:row;justify-content:space-between}.flashTime[data-v-6e38691a]{margin:1vh 0;display:flex;flex-direction:row;justify-content:space-between}.sum[data-v-6e38691a]{margin:1vh 0;display:flex;flex-direction:row-reverse}.pay[data-v-6e38691a]{width:100vw;height:4vh;padding:5vw;position:fixed;bottom:0;background-color:#fff;display:flex;flex-direction:row;justify-content:space-between}.btn[data-v-6e38691a]{width:28vw;height:3vh;margin-right:10vw;background-color:red;color:#fff;line-height:3vh;text-align:center;border-radius:12px}\n\n/* 弹窗 */.modal[data-v-6e38691a]{position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);background-color:#fff;width:70vw;border:1px #c3c3c3 solid;padding:1vh 3vw}.inputItem[data-v-6e38691a]{display:flex;flex-direction:row;font-size:12px;margin:2vh 0;vertical-align:sub}.input[data-v-6e38691a]{margin-left:3vw;border-bottom:1px #c3c3c3 solid}",""]),e.exports=t},b9a2:function(e,t,i){var a=i("7bb4");"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var n=i("4f06").default;n("77aa19fc",a,!0,{sourceMap:!1,shadowMode:!1})},e0df:function(e,t,i){"use strict";(function(e){var a=i("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;a(i("015a")),a(i("567c"));var n=i("2bfd"),o={data:function(){return{showPop:!1,details:{},person:getApp().globalData.UserInfo,post:{order_user_id:void 0,store_id:void 0,goods_id:void 0,coupons_id:void 0,number:void 0,order_status:void 0,consignee_name:void 0,consignee_phone:void 0,consignee_address:void 0,deliver_type:void 0,order_time:void 0,deliver_time:void 0}}},computed:{},onLoad:function(t){t.details&&(this.details=JSON.parse(decodeURIComponent(t.details)),e("log",this.details," at pages/panicTicketOrder/panicTicketOrder.vue:102")),this.person.number=1,e("log",getApp().globalData.UserInfo," at pages/panicTicketOrder/panicTicketOrder.vue:105")},methods:{buy:function(){if(this.person.real_name&&this.person.tel&&this.person.star>=this.details.coupons.star&&this.person.beans>=this.person.number*this.details.panicBuyingCoupons.panic_buying_price){this.post.order_user_id=this.person.id,this.post.store_id=this.details.coupons.store_id?this.details.coupons.store_id:1,this.post.goods_id=this.details.coupons.goods_id,this.post.coupons_id=this.details.coupons.coupon_id,this.post.number=this.person.number,this.post.order_status="已支付",this.post.consignee_name=this.person.real_name,this.post.consignee_phone=this.person.tel,this.post.consignee_address="0",this.post.deliver_type="0",this.post.order_time=(new Date).getTime(),this.post.deliver_time=void 0,e("log",this.post," at pages/panicTicketOrder/panicTicketOrder.vue:124");var t=getApp(),i={user_id:this.person.id,type:2,thingsId:this.details.coupons.coupon_id};uni.request({url:n.baseURL+"/pb_orders",method:"POST",data:this.post,header:{Authorization:"Bearer "+t.globalData.Authorization},dataType:"json",sslVerify:!1,success:function(a){if(e("log",a," at pages/panicTicketOrder/panicTicketOrder.vue:145"),200==a.data.code){uni.showLoading({title:a.data.message});var n=setInterval((function(){uni.request({url:"http://yibinmall.chenglee.top:8080/pb_orders/result/"+i.user_id+"/"+i.type+"/"+i.thingsId,method:"GET",header:{Authorization:"Bearer "+t.globalData.Authorization},dataType:"json",sslVerify:!1,success:function(t){e("log",t," at pages/panicTicketOrder/panicTicketOrder.vue:161"),uni.hideLoading(),200==t.data.code?(uni.showModal({title:"抢购成功",success:function(e){(e.confirm||e.cancel)&&setTimeout((function(){uni.navigateTo({url:"../mall/mall"})}),500)}}),clearInterval(n)):500==t.data.code&&(uni.hideLoading(),uni.showToast({icon:"none",title:t.data.message}),clearInterval(n))},fail:function(e){uni.hideLoading(),uni.showToast({icon:"none",title:"订单信息获取失败，请重试！"}),uni.hideLoading()}})}),1e3)}else uni.showToast({icon:"none",title:a.data.message})},fail:function(e){uni.showToast({icon:"none",title:"订单信息发送失败，请重试！"})}})}else this.person.star<this.details.star?uni.showToast({icon:"none",title:"用户星级不足"}):this.person.beans<this.person.number*this.details.coupon_price?uni.showToast({icon:"none",title:"用户鲜豆不足"}):uni.showToast({icon:"none",title:"请检查收货信息是否正确"})},change:function(){this.showPop=!0},closeModal:function(){this.showPop=!1}}};t.default=o}).call(this,i("0de9")["log"])}}]);